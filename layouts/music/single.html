{{- define "main" }}

{{- $releases := slice
  (dict "title" "At Once, Grace." "year" "2020" "type" "Album"  "image" "at-once-grace.png"         "spotify" "https://open.spotify.com/album/49mGgC27dDng4UFQrDoBLO" "applemusic" "https://music.apple.com/au/album/at-once-grace/1533464874")
  (dict "title" "Epoché"           "year" "2022" "type" "Single" "image" "epoche.png"                "spotify" "https://open.spotify.com/album/47vZzPCXvlvaEeyWDeeoVr" "applemusic" "https://music.apple.com/au/album/epoch%C3%A9-single/1639236307")
  (dict "title" "O Beauty, Where Art Thou?" "year" "2022" "type" "Single" "image" "o-beauty-where-art-thou.png" "spotify" "https://open.spotify.com/album/4RoAZZ0GQ1FcpgKG7CQiId" "applemusic" "https://music.apple.com/au/album/o-beauty-where-art-thou-single/1622724768")
  (dict "title" "Jacob"            "year" "2022" "type" "Single" "image" "jacob.png"                 "spotify" "https://open.spotify.com/album/1ceSmETc30tAD92tppiAxI" "applemusic" "https://music.apple.com/au/album/jacob-single/1622271677")
  (dict "title" "Here. Now."       "year" "2020" "type" "Single" "image" "here-now.png"              "spotify" "https://open.spotify.com/album/0kgMRnJAstub96pZy9pu8i" "applemusic" "https://music.apple.com/au/album/here-now-single/1511054958")
  (dict "title" "Wavering Confidence" "year" "2020" "type" "Single" "image" "wavering-confidence.jpg" "spotify" "https://open.spotify.com/album/4I6kddYls8OOSLZbuVGBT2" "applemusic" "https://music.apple.com/au/album/wavering-confidence-single/1511530182")
  (dict "title" "At Motion"        "year" "2020" "type" "Single" "image" "at-motion.png"             "spotify" "https://open.spotify.com/album/3vrHOHVVBjpwogNjtdXr9k" "applemusic" "https://music.apple.com/au/album/at-motion-single/1516989243")
-}}

<article class="post-single">
  <header class="post-header">
    {{ partial "breadcrumbs.html" . }}
    <h1 class="post-title">{{ .Title }}</h1>
    {{- if .Description }}
    <div class="post-description">{{ .Description }}</div>
    {{- end }}
  </header>

  {{- if .Content }}
  <div class="post-content">
    {{- partial "anchored_headings.html" .Content -}}
  </div>
  {{- end }}

  <div class="music-grid">
    {{- range $releases }}
    {{- $img := $.Resources.GetMatch .image }}
    <div class="release">
      <a class="artwork-link" href="{{ .spotify }}" target="_blank" rel="noopener noreferrer">
        {{- if $img }}
        <img src="{{ $img.RelPermalink }}" alt="{{ .title }}" loading="lazy">
        {{- else }}
        <div class="artwork-placeholder"></div>
        {{- end }}
      </a>
      <div class="release-info">
        <p class="release-title">
          {{- .title }}
          {{- if eq .type "Album" }}<span class="release-badge">Album</span>{{- end }}
        </p>
        <p class="release-meta">{{ .year }}{{ if ne .type "Album" }} · {{ .type }}{{ end }}</p>
        <div class="release-links">
          <a class="release-link" href="{{ .spotify }}" target="_blank" rel="noopener noreferrer">Spotify →</a>
          {{- if .applemusic }}
          <a class="release-link" href="{{ .applemusic }}" target="_blank" rel="noopener noreferrer">Apple Music →</a>
          {{- end }}
        </div>
      </div>
    </div>
    {{- end }}
  </div>

  <footer class="post-footer">
    {{- if (.Param "ShowPostNavLinks") }}
    {{- partial "post_nav_links.html" . }}
    {{- end }}
  </footer>
</article>

{{- end }}
